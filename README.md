# 中学体力テスト記録システム

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

生徒が体力テストの記録を入力・管理し、先生のGoogleスプレッドシートに自動送信できるWebアプリケーションです。

## 🎯 主な機能

### 📊 記録管理
- **9種目の体力テスト記録入力**
  - 握力、上体起こし、長座体前屈、反復横とび
  - 持久走、20mシャトルラン
  - 50m走、立ち幅跳び、ハンドボール投げ
- **自動点数計算**（文部科学省基準に準拠）
- **総合評価判定**（A～E段階）
- **地域平均との比較**（帯広市、北海道、全国）

### 📈 データ分析・可視化
1. **レーダーチャート**
   - 自分の記録と地域平均を視覚的に比較
   - 表示項目の切り替え機能
   
2. **経年変化グラフ**
   - 中1～中3の成長過程を追跡
   - 各種目ごとの伸び率を可視化

3. **体力分析**
   - パワー型、持久力型、敏捷性型、柔軟性型の4タイプ診断
   - 各能力のレベル表示
   - 総合ランク評価

4. **目標達成シミュレーター**
   - A～D評価を目指すための具体的アドバイス
   - 優先的に伸ばすべき種目の提案

5. **種目別トラッキング**
   - 授業や練習ごとの記録を追加
   - 時系列グラフで変容を可視化
   - 統計情報と分析コメント表示

### 💾 データ管理
- **バックアップ・復元機能**
  - JSON形式でのエクスポート
  - 全データ（測定値、経年データ、トラッキングデータ）の保存
- **年次データ保存**
  - 各学年の記録を保存して経年比較
- **ローカルストレージ自動保存**
  - ブラウザを閉じても記録が保持される

### 📤 先生への送信機能
- **Google Apps Scriptとの連携**
  - 記録を先生のスプレッドシートに自動送信
  - 出席番号、氏名、性別、学年、組、測定回を含む
- **URLパラメータでの自動設定**
  - 先生が配布したURLにアクセスするだけで設定完了

## 🚀 セットアップ手順

### 生徒向け

#### パターンA: 先生からURLを受け取った場合（推奨）
1. 先生から配布されたURLをクリック
2. そのまま使用開始（設定不要）

#### パターンB: 直接アクセスする場合
1. このWebアプリにアクセス
2. 「⚙️ 初回設定」ボタンをクリック
3. 先生から受け取ったGoogle Apps ScriptのURLを入力

### 先生向け

#### 1. Googleスプレッドシートの準備
1. 新しいGoogleスプレッドシートを作成
2. 「拡張機能」→「Apps Script」を開く

#### 2. Apps Scriptコードの作成
以下のコードを貼り付けます：

```javascript
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = ss.getSheetByName('体力テスト記録');
    
    if (!sheet) {
      sheet = ss.insertSheet('体力テスト記録');
      sheet.appendRow([
        '出席番号', '氏名', '性別', '学年', '組', '測定回',
        '握力', '上体起こし', '長座体前屈', '反復横とび',
        '持久走', 'シャトルラン', '50m走', '立ち幅跳び', 'ハンドボール投げ',
        '送信日時'
      ]);
    }
    
    sheet.appendRow([
      data.studentId,
      data.name,
      data.gender === 'male' ? '男子' : '女子',
      data.grade,
      data.class,
      data.session,
      data.grip,
      data.situp,
      data.forward,
      data.sidestep,
      data.endurance,
      data.shuttle,
      data.sprint50,
      data.jump,
      data.throw,
      new Date()
    ]);
    
    return ContentService.createTextOutput(
      JSON.stringify({success: true})
    ).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    return ContentService.createTextOutput(
      JSON.stringify({success: false, error: error.toString()})
    ).setMimeType(ContentService.MimeType.JSON);
  }
}
```

#### 3. デプロイ
1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 種類：「ウェブアプリ」を選択
3. 次のユーザーとして実行：「自分」
4. アクセスできるユーザー：「全員」
5. 「デプロイ」をクリック
6. 表示される「ウェブアプリURL」をコピー

#### 4. 生徒配布用URLの生成
1. このWebアプリを開く
2. 「⚙️ 初回設定」ボタンをクリック
3. ガイドに従って、コピーしたURLを入力
4. 生成された「生徒配布用URL」をコピー
5. Google Classroomなどで生徒に配布

## 📖 使い方

### 基本的な使い方

1. **性別・学年・組・測定回を選択**
   - 画面上部のプルダウンメニューで設定

2. **記録を入力**
   - マイレコードテーブルに測定値を入力
   - 自動的に点数と評価が計算される

3. **データを保存**
   - 入力は自動保存される
   - 「📅 今年を記録」で年次データとして保存

4. **先生に送信**
   - 「📤 先生に送信」ボタンをクリック
   - 出席番号と氏名を入力して送信

### グラフ・分析機能

#### レーダーチャート
- 9種目のバランスを視覚的に確認
- 地域平均や前年度との比較が可能
- 凡例をクリックで表示/非表示を切り替え

#### 経年変化グラフ
- 中1～中3の成長過程を確認
- 各種目の伸び率を比較

#### 体力分析
- 自分の体力タイプを診断
- 得意な種目と伸びしろのある種目を表示
- 目標達成のための具体的アドバイス

#### 種目別トラッキング
- 授業ごとの記録を追加
- 単元名やメモも記録可能
- 統計情報で成長を確認

### データ管理

#### バックアップ
- 「💾 バックアップ」でJSONファイルをダウンロード
- 全データ（測定値、経年データ、トラッキング）を保存

#### 復元
- 「📂 復元」でバックアップファイルを選択
- すべてのデータを復元

#### 印刷
- 「🖨️ 印刷」でレポートを印刷
- レーダーチャートも含まれる

## 🗂️ プロジェクト構造

```
.
├── index.html          # メインHTMLファイル
├── css/
│   └── style.css      # スタイルシート
├── js/
│   ├── data.js        # 体力テスト基準データ
│   ├── app.js         # メインアプリケーションロジック
│   ├── charts.js      # グラフ・分析機能
│   └── setup.js       # 初回設定ガイド
└── README.md          # このファイル
```

## 💾 データ保存仕様

### LocalStorageキー
- `m-male` / `m-female`: 現在の測定値
- `y-male` / `y-female`: 年次データ
- `tracking-male` / `tracking-female`: トラッキングデータ
- `teacherScriptUrl`: 先生のGoogle Apps Script URL

### バックアップファイル形式（JSON）
```json
{
  "v": "2.0",
  "d": "2025-12-23T12:00:00.000Z",
  "g": "male",
  "gr": 2,
  "vals": [30.5, 28, 45, 52, null, 85, 7.8, 210, 25],
  "yearData": {
    "中1": {
      "v": [...],
      "d": "2024-06-15T..."
    },
    "中2": {
      "v": [...],
      "d": "2025-06-20T..."
    }
  },
  "trackingData": {
    "0": [
      {
        "date": "2025-04-10",
        "value": 28.5,
        "unit": "バスケットボール",
        "memo": "シュート練習",
        "score": 7
      }
    ]
  }
}
```

## 📊 点数基準

文部科学省「新体力テスト実施要項」に基づく10段階評価を採用しています。

### 総合評価（A～E）

| 段階 | 中1 (13歳) | 中2 (14歳) | 中3 (15歳) |
|------|-----------|-----------|-----------|
| A | 57以上 | 60以上 | 61以上 |
| B | 47～56 | 51～59 | 52～60 |
| C | 37～46 | 41～50 | 41～51 |
| D | 27～36 | 31～40 | 31～40 |
| E | 26以下 | 30以下 | 30以下 |

## 🎨 特徴

### UI/UX
- **レスポンシブデザイン**: スマホ・タブレット・PCに対応
- **モダンなデザイン**: グラデーションとアニメーション効果
- **直感的な操作**: ボタン一つでグラフ表示やデータ送信

### パフォーマンス
- **ローカルストレージ**: 高速なデータ保存・読み込み
- **Canvas描画**: 軽量なグラフ描画（ライブラリ不使用）
- **自動保存**: 入力の都度自動的に保存

### データセキュリティ
- **ローカル保存**: データはブラウザ内に保存（外部流出なし）
- **Base64エンコード**: URLパラメータでの安全な情報受け渡し
- **no-cors送信**: 先生のスプレッドシートへの安全な送信

## 🔧 カスタマイズ

### 地域平均データの変更
`js/data.js`の`A`オブジェクトを編集：

```javascript
const A = {
    male: {
        あなたの地域: [29.47, 25.10, 42.99, ...],
        北海道: [29.57, 25.24, 42.77, ...],
        全国: [28.95, 25.94, 44.47, ...]
    },
    // ...
};
```

### 組の追加
`index.html`の選択肢を追加：

```html
<select id="class">
    <option value="A">A組</option>
    <option value="B">B組</option>
    <option value="C">C組</option>
    <option value="D">D組</option>
    <option value="E">E組</option> <!-- 追加 -->
</select>
```

## 🐛 トラブルシューティング

### データが保存されない
- ブラウザのCookie/ローカルストレージが有効か確認
- プライベートモード・シークレットモードでは保存されない場合があります

### 先生に送信できない
- 「⚙️ 初回設定」でURLが正しく設定されているか確認
- 先生のGoogle Apps Scriptが正しくデプロイされているか確認

### グラフが表示されない
- データが入力されているか確認
- ブラウザのキャッシュをクリアしてリロード

## 📝 更新履歴

### v2.0.0 (2025-12-23)
- プロジェクト構造を整理（HTML、CSS、JavaScriptを分離）
- URLパラメータからの自動設定機能を追加
- 初回設定ガイドの改善
- バックアップ形式をv2.0に更新（トラッキングデータを含む）
- コードの可読性とメンテナンス性を向上

### v1.0.0 (初期リリース)
- 基本的な記録機能
- レーダーチャート、経年変化グラフ
- 体力分析、目標達成シミュレーター
- 種目別トラッキング
- Google Apps Script連携

## 📄 ライセンス

MIT License

## 🤝 貢献

バグ報告や機能提案は、GitHubのIssueからお願いします。

## 📧 お問い合わせ

質問や要望がありましたら、GitHubのIssueまでお願いします。

---

**製作**: 体力テスト記録システム開発チーム  
**最終更新**: 2025年12月23日

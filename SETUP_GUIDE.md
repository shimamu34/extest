# 先生向けセットアップガイド

## 📋 概要

このガイドでは、生徒から送信される体力テストのデータを自動的にGoogleスプレッドシートで管理する方法を説明します。

## ⏱️ 所要時間

約15～20分

## 🔧 必要なもの

- Googleアカウント
- Googleスプレッドシートへのアクセス権

---

## 🚀 セットアップ手順

### ステップ1: Googleスプレッドシートの作成

1. [Google スプレッドシート](https://sheets.google.com/)にアクセス
2. 「新しいスプレッドシートを作成」をクリック
3. スプレッドシートに名前をつける（例：「2025年度 体力テスト記録」）

### ステップ2: Apps Scriptエディタを開く

1. スプレッドシート上部のメニューから「拡張機能」をクリック
2. 「Apps Script」を選択

![Apps Scriptメニュー](https://via.placeholder.com/600x200/4285f4/ffffff?text=拡張機能+→+Apps+Script)

### ステップ3: スクリプトコードの貼り付け

1. Apps Scriptエディタが開きます
2. 既存のコード（`function myFunction() { ... }`）を**すべて削除**
3. このプロジェクトの`google-apps-script.gs`ファイルの内容をコピー
4. Apps Scriptエディタに貼り付け
5. 上部の「💾 保存」アイコンをクリック

```javascript
// google-apps-script.gsの内容をここに貼り付けます
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    // ... 以下省略
  }
}
```

### ステップ4: プロジェクト名の設定

1. 左上の「無題のプロジェクト」をクリック
2. プロジェクト名を入力（例：「体力テスト記録システム」）
3. 「名前を変更」をクリック

### ステップ5: デプロイの実行

1. 右上の「🚀 デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択

![デプロイボタン](https://via.placeholder.com/600x200/34a853/ffffff?text=デプロイ+→+新しいデプロイ)

3. 「⚙️ 種類の選択」（歯車アイコン）をクリック
4. 「ウェブアプリ」を選択

### ステップ6: デプロイ設定

以下の設定を確認してください：

| 項目 | 設定値 |
|------|--------|
| **説明** | 任意（例：初回デプロイ） |
| **次のユーザーとして実行** | **自分（あなたのメールアドレス）** |
| **アクセスできるユーザー** | **全員** |

![デプロイ設定](https://via.placeholder.com/600x300/fbbc04/ffffff?text=実行ユーザー：自分+/+アクセス：全員)

⚠️ **重要**: 「アクセスできるユーザー」を「全員」に設定しないと、生徒からのデータを受信できません。

### ステップ7: 承認プロセス

1. 「デプロイ」ボタンをクリック
2. 「承認が必要です」と表示される場合
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」をクリック
   - 「（安全ではないページに移動）」をクリック
   - 「許可」をクリック

![承認画面](https://via.placeholder.com/600x400/ea4335/ffffff?text=承認画面)

### ステップ8: ウェブアプリURLのコピー

1. デプロイが完了すると「ウェブアプリ URL」が表示されます
2. この URLをコピーしてください

```
https://script.google.com/macros/s/AKfycby.../exec
```

⚠️ **このURLは後で使用するので、メモ帳などに保存しておいてください**

3. 「完了」をクリック

---

## 🎯 生徒配布用URLの生成

### ステップ9: 体力テストアプリへのアクセス

1. 体力テストアプリ（index.html）を開く
2. 「⚙️ 初回設定」ボタンをクリック

### ステップ10: URLの登録

1. ガイドが表示されます
2. 「はじめる」をクリック
3. コピーしたウェブアプリURLを入力欄に貼り付け
4. 「保存して次へ」をクリック

### ステップ11: 生徒配布用URLの取得

1. 「生徒配布用URL」が自動生成されます
2. 「📋 URLをコピー」ボタンをクリック

生成されるURLの例：
```
https://your-app-url.com/index.html?t=aHR0cHM6Ly9zY3JpcHQuZ29...
```

---

## 📱 生徒への配布方法

### Google Classroomで配布する場合

1. Google Classroomを開く
2. 「授業」タブから該当のクラスを選択
3. 「課題」または「お知らせ」を作成
4. 生徒配布用URLを貼り付け
5. 「投稿」をクリック

**投稿例：**
```
【体力テスト記録】
以下のURLから体力テストの記録を入力してください。
入力した記録は自動的に先生のスプレッドシートに送信されます。

URL: https://...
```

### メールで配布する場合

1. メールアプリを開く
2. 生徒全員をBCCに追加
3. 件名：「体力テスト記録システムのご案内」
4. 本文に生徒配布用URLを記載
5. 送信

---

## ✅ 動作確認

### テストデータの送信

1. 生徒配布用URLをあなた自身で開く
2. テストデータを入力
3. 「📤 先生に送信」をクリック
4. 出席番号と氏名を入力
5. Googleスプレッドシートを確認

### 確認ポイント

- [ ] 「体力テスト記録」シートが自動作成されている
- [ ] ヘッダー行（出席番号、氏名、性別...）が表示されている
- [ ] テストデータが正しく記録されている
- [ ] 送信日時が記録されている

---

## 📊 データの集計

### クラス別平均の計算

スプレッドシート上部のメニューに「📊 体力テスト」が追加されています。

1. 「📊 体力テスト」→「📈 クラス別平均を計算」をクリック
2. 「クラス別平均」シートが自動作成されます
3. 各クラスの平均値が計算されます

### データのエクスポート

- **CSV形式**: ファイル→ダウンロード→カンマ区切り形式（.csv）
- **Excel形式**: ファイル→ダウンロード→Microsoft Excel（.xlsx）

---

## 🔧 トラブルシューティング

### データが記録されない

#### 原因1: デプロイ設定が間違っている
**解決方法:**
1. Apps Scriptエディタの「デプロイ」→「デプロイを管理」を開く
2. 「アクセスできるユーザー」が「全員」になっているか確認
3. 異なる場合は、編集して「全員」に変更
4. 「デプロイを更新」をクリック

#### 原因2: URLが間違っている
**解決方法:**
1. Apps Scriptエディタの「デプロイ」→「デプロイを管理」を開く
2. 「ウェブアプリ URL」を再度コピー
3. 体力テストアプリの「⚙️ 初回設定」で再設定

#### 原因3: スクリプトにエラーがある
**解決方法:**
1. Apps Scriptエディタで「実行ログ」を確認
2. エラーメッセージを確認
3. コードを再度コピー&ペーストしてみる

### 生徒が「送信に失敗しました」と表示される

#### 原因: ブラウザの設定
**解決方法:**
- シークレットモード/プライベートブラウジングでは動作しない場合があります
- 通常モードで開くよう指示してください

### スプレッドシートにデータが2重に記録される

#### 原因: 生徒が2回送信ボタンを押した
**解決方法:**
- データ行を手動で削除してください
- 生徒には「送信は1回だけ」と伝えてください

---

## 🎨 カスタマイズ

### シートの名前を変更したい

`google-apps-script.gs`の以下の部分を編集：

```javascript
let sheet = ss.getSheetByName('体力テスト記録'); // ここを変更
```

### 記録する項目を追加したい

1. `google-apps-script.gs`のヘッダー行に項目を追加
2. `sheet.appendRow([...])` に対応するデータを追加
3. 体力テストアプリ側も修正が必要です

---

## 📞 サポート

### よくある質問

**Q: 複数のクラスで同じスプレッドシートを使えますか？**  
A: はい、可能です。「クラス」列で区別できます。

**Q: 年度が変わったらどうすればいいですか？**  
A: 新しいスプレッドシートを作成して、同じ手順でセットアップしてください。

**Q: 生徒が誤ったデータを送信した場合は？**  
A: スプレッドシート上で直接編集できます。

**Q: データのバックアップは？**  
A: Googleスプレッドシート自体が自動保存されます。定期的にCSVエクスポートすることをお勧めします。

---

## 📝 チェックリスト

セットアップが完了したら、以下を確認してください：

- [ ] Googleスプレッドシートを作成した
- [ ] Apps Scriptコードを貼り付けた
- [ ] デプロイを実行した（アクセス：全員）
- [ ] ウェブアプリURLをコピーした
- [ ] 体力テストアプリで初回設定を完了した
- [ ] 生徒配布用URLを取得した
- [ ] テストデータで動作確認した
- [ ] 生徒にURLを配布した

---

**作成日**: 2025年12月23日  
**バージョン**: 1.0

ご不明な点がございましたら、システム管理者にお問い合わせください。

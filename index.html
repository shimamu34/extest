<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å­¦ä½“åŠ›ãƒ†ã‚¹ãƒˆè¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 style="letter-spacing: 4px; font-family: 'Helvetica Neue', Arial, sans-serif;">
        ğŸ“ ã€€ä½“åŠ›ãƒ†ã‚¹ãƒˆåˆ†æã‚·ã‚¹ãƒ†ãƒ 
        <span style="display: block; font-size: 0.5em; font-weight: normal; letter-spacing: 1px; opacity: 0.8; margin-top: 5px;">
            Physical Analysis System 2025
        </span>
    </h1>
    
    <div class="card no-print" style="text-align:center">
        <button class="btn btn-clear" onclick="C()">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
        <button class="btn btn-print" onclick="preparePrint()">ğŸ–¨ï¸ å°åˆ·</button>
        <button class="btn btn-send" onclick="sendToTeacher()">ğŸ“¤ å…ˆç”Ÿã«é€ä¿¡</button>
        <button class="btn btn-setup" onclick="checkPasscode()">âš™ï¸ åˆå›è¨­å®š</button>
    </div>
    
    <div class="card">
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));">
            <div class="form-group">
                <label for="gender">æ€§åˆ¥</label>
                <select id="gender">
                    <option value="m">ç”·å­</option>
                    <option value="f">å¥³å­</option>
                </select>
            </div>
            <div class="form-group">
                <label for="grade">å­¦å¹´</label>
                <select id="grade">
                    <option value="1">ä¸­å­¦1å¹´</option>
                    <option value="2">ä¸­å­¦2å¹´</option>
                    <option value="3">ä¸­å­¦3å¹´</option>
                </select>
            </div>
            <div class="form-group">
                <label for="class">ã‚¯ãƒ©ã‚¹</label>
                <input type="text" id="class" placeholder="ä¾‹: A" maxlength="2">
            </div>
            <div class="form-group">
                <label for="session">å›æ•°</label>
                <select id="session">
                    <option value="1">1å›ç›®ï¼ˆå½“åˆï¼‰</option>
                    <option value="2">2å›ç›®ï¼ˆäº‹å¾Œï¼‰</option>
                </select>
            </div>
        </div>
        <div id="lastSaved" style="text-align:right; font-size:0.8em; color:#888; margin-top:10px;"></div>
    </div>

    <div class="card overflow-x">
        <h3>ğŸ“Š å€‹äººæ¸¬å®šãƒ­ã‚°</h3>
        <div id="table"></div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>ğŸ“ˆ ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãƒãƒ©ãƒ³ã‚¹</h3>
            <div id="radar"></div>
        </div>
        <div class="card">
            <h3>ğŸ† ç·åˆè©•ä¾¡</h3>
            <div id="totalRank" style="text-align:center; padding:20px; font-weight:bold; color:#2b6cb0;"></div>
            <div id="fitnessPokedex" class="pokedex-grid"></div>
        </div>
    </div>

    <div class="card no-print">
        <h3>ğŸ¯ ç›®æ¨™ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h3>
        <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">ç›®æŒ‡ã—ãŸã„ãƒ©ãƒ³ã‚¯ã‚’é¸æŠã™ã‚‹ã¨ã€ã‚ã¨ä½•ç‚¹å¿…è¦ã‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
            <button class="btn" style="background:#FFD700; color:#333;" onclick="setGoal('rankA')">Aè©•ä¾¡ã‚’ç›®æŒ‡ã™</button>
            <button class="btn" style="background:#C0C0C0; color:#333;" onclick="setGoal('rankB')">Bè©•ä¾¡ã‚’ç›®æŒ‡ã™</button>
            <button class="btn" style="background:#CD7F32; color:white;" onclick="setGoal('rankC')">Cè©•ä¾¡ã‚’ç›®æŒ‡ã™</button>
            <button class="btn" style="background:#9e9e9e; color:white;" onclick="setGoal('rankD')">Dè©•ä¾¡ã‚’ç›®æŒ‡ã™</button>
        </div>
        <div id="goalSimulator"></div>
        <div id="correlation" style="margin-top:20px; padding:15px; background:#f0f7ff; border-radius:8px;">
            <h6 style="margin:0 0 10px 0; color:#2b6cb0;">ğŸ’¡ è±†çŸ¥è­˜ï¼šç¨®ç›®é–“ã®é–¢ä¿‚</h6>
            <p style="margin:0; font-size:0.9em; color:#4a5568;">ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã‚ãªãŸã«åˆã£ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        </div>
    </div>

    <div class="card overflow-x no-print">
        <h3>ğŸ”¢ é …ç›®åˆ¥å¾—ç‚¹è¡¨</h3>
        <div id="score" class="small-table"></div>
    </div>

    <div class="card no-print">
        <h3>ğŸ“‹ ç·åˆå¾—ç‚¹ æ®µéšè¡¨</h3>
        <div id="eval" class="small-table"></div>
    </div>

    <div id="notif" class="notification"></div>
    <div id="setupGuide" class="modal" style="display:none;">
        <div class="modal-content">
            <h3>âš™ï¸ å…ˆç”Ÿç”¨ãƒ»åˆæœŸè¨­å®šã‚¬ã‚¤ãƒ‰</h3>
            <p>1. Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</p>
            <input type="text" id="gasUrlInput" placeholder="https://script.google.com/macros/s/.../exec" style="width:100%; padding:10px; margin-bottom:10px;">
            <button class="btn btn-send" onclick="saveGasUrl()">URLã‚’ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
            <hr>
            <p>2. ç”Ÿå¾’é…å¸ƒç”¨ã®URLã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä¸Šè¨˜URLã‚’å…¥åŠ›å¾Œã«ã‚¯ãƒªãƒƒã‚¯ï¼š</p>
            <button class="btn" onclick="generateStudentUrl()">é…å¸ƒç”¨URLã‚’ç”Ÿæˆ</button>
            <div id="studentUrlArea" style="display:none; margin-top:10px; padding:10px; background:#eee; word-break:break-all;">
                <p style="font-size:0.8em; font-weight:bold;">ç”Ÿå¾’ã«é€ã‚‹URLï¼š</p>
                <div id="generatedUrl" style="font-size:0.8em; color:#2b6cb0;"></div>
            </div>
            <button class="btn btn-clear" onclick="document.getElementById('setupGuide').style.display='none'">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/setup.js"></script>

    <script>
    // 1. ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
    function checkPasscode() {
        const code = prompt("ç®¡ç†è€…ç”¨ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ4æ¡ï¼‰");
        if (code === "9076") {
            showSetupGuide();
        } else if (code !== null) {
            alert("ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚");
        }
    }

    // 2. è¨­å®šç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showSetupGuide() {
        const gasInput = document.getElementById('gasUrlInput');
        const urlArea = document.getElementById('studentUrlArea');
        if (gasInput) gasInput.value = localStorage.getItem('gasUrl') || "";
        if (urlArea) urlArea.style.display = "none";
        document.getElementById('setupGuide').style.display = 'block';
    }

    // 3. GAS URLã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
    function saveGasUrl() {
        const url = document.getElementById('gasUrlInput').value.trim();
        if (url.startsWith('https://script.google.com')) {
            localStorage.setItem('gasUrl', url);
            alert("ä¿å­˜ã—ã¾ã—ãŸã€‚");
            document.getElementById('setupGuide').style.display = 'none';
        } else {
            alert("æœ‰åŠ¹ãªGASã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        }
    }

    // 4. ç”Ÿå¾’ç”¨URLã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function generateStudentUrl() {
        const gasUrl = document.getElementById('gasUrlInput').value.trim();
        if (!gasUrl) return alert("å…ˆã«GASã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        const baseUrl = window.location.href.split('?')[0];
        const encodedUrl = btoa(unescape(encodeURIComponent(gasUrl)));
        const finalUrl = `${baseUrl}?t=${encodedUrl}`;
        document.getElementById('generatedUrl').textContent = finalUrl;
        document.getElementById('studentUrlArea').style.display = 'block';
    }
    </script>
</body>
</html>
